<!-- app/templates/gallery.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>성사천 달빛걷기 갤러리</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS + Icons -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    rel="stylesheet"
  />

  <style>
    body { background: white; margin:0; padding:0; }
    .btn-upload {
      position: fixed; top:10px; right:10px; z-index:1000;
      background:#ffc107; color:#000; border:none;
      font-size:1.2rem; padding:.6rem 1.2rem;
      border-radius:.5rem; box-shadow:0 4px 8px rgba(0,0,0,.2);
      text-decoration: none;
    }
    .btn-upload:hover { 
      background:#e0a800; text-decoration: none;
    }

    .container { padding:0 4px; margin-top:60px; }
    .page-title {
      font-size:1.5rem; font-weight:600;
      margin:0 0 1rem .5rem;
    }

    .row { margin:0!important; gap:0; }
    .col-4 {
      flex:0 0 33.3333%!important;
      max-width:33.3333%!important;
      padding:0 4px!important; margin-bottom:8px;
    }

    .card {
      position: relative; border:none; padding:0; background:none;
    }
    .gallery-img,
    .gallery-video-thumb {
      width:100%; height:auto; display:block; border-radius:4px;
    }
    .gallery-video-thumb { object-fit:cover; }

    /* 미디어 타입 아이콘 */
    .media-icon {
      position:absolute; top:3px; right:3px;
      background:rgba(0,0,0,.5); color:#fff; border-radius:50%;
      width:1.6rem; height:1.6rem;
      display:flex; align-items:center; justify-content:center;
      font-size:1rem; z-index:2;
    }

    /* Modal 내부 스타일 */
    .modal-img, .modal-video {
      max-width:100%; max-height:70vh;
      display:block; margin:0 auto; border-radius:4px;
    }

    .modal-close-v1 {
      width: 2.5rem;
      height: 2.5rem;
      background-color: rgba(255, 255, 255, 0.8) !important;
      border-radius: 50% !important;
      /* 버튼 안 아이콘(×) 크기 조정 */
      font-size: 1.25rem;
      /* 그림자 추가로 대비 높임 */
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
      top: 0.5rem;
      right: 0.5rem;
    }
  </style>
</head>
<body>
  <a href="/upload" class="btn-upload">업로드하기</a>
  <div class="container">
    <h2 class="page-title">성사천 달빛걷기 갤러리</h2>
    <div class="row gx-0 gy-0">
      {% for img in images %}
        {% set base = img.filename.rsplit('.',1)[0] %}
        <div class="col-4">
          <div class="card">
            {% if img.is_video %}
              <!-- 비디오 썸네일 -->
              <video
                class="gallery-video-thumb btn-open-modal"
                data-type="video"
                data-filename="{{ img.filename }}"
                muted preload="metadata"
                poster="/static/uploads/thumbs/{{ base }}.jpeg"
              >
                <source
                  src="/static/uploads/{{ img.filename }}"
                  type="video/{{ img.filename.rsplit('.',1)[1] }}"
                />
                브라우저가 video 태그를 지원하지 않습니다.
              </video>
              <span class="media-icon"><i class="bi bi-play-circle-fill"></i></span>
            {% else %}
              <!-- 이미지 썸네일 -->
              <img
                src="/static/uploads/thumbs/{{ img.filename }}"
                alt="{{ img.filename }}"
                class="gallery-img btn-open-modal"
                data-type="image"
                data-filename="{{ img.filename }}"
              />
              <span class="media-icon"><i class="bi bi-image-fill"></i></span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="mediaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-fullscreen-sm-down modal-dialog-centered">
      <div class="modal-content bg-transparent border-0">
        <div class="modal-body position-relative p-0">
          <button
            type="button"
            class="btn-close btn-close-white position-absolute modal-close-v1"
            style="top:10px; right:10px; z-index:1050;"
            data-bs-dismiss="modal"
            aria-label="닫기"
          ></button>
          <img src="" id="modalImage" class="modal-img" style="display:none" alt="Original" />
          <video id="modalVideo" class="modal-video" controls style="display:none"></video>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS + Popper -->
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.7/dist/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // 모달 초기화
      const mediaModal = new bootstrap.Modal(document.getElementById("mediaModal"));
      document.querySelectorAll(".btn-open-modal").forEach(el => {
        el.addEventListener("click", e => {
          e.preventDefault();
          const type = el.dataset.type;
          const file = el.dataset.filename;
          const imgEl = document.getElementById("modalImage");
          const vidEl = document.getElementById("modalVideo");

          if (type === "video") {
            imgEl.style.display = "none";
            vidEl.src = `/static/uploads/${file}`;
            vidEl.style.display = "block";
          } else {
            vidEl.style.display = "none";
            imgEl.src = `/static/uploads/${file}`;
            imgEl.style.display = "block";
          }
          mediaModal.show();
        });
      });
    });
  </script>
</body>
</html>

